---
layout: post
title: "[머신러닝] 교통사고 건수 예측모델"
date: 2021-01-21 08:44:38 -0400
category: project
subcategory: 
author: eun
short-description: 교통사고 발생에 관여하는 주요 변수를 파악해 교통사고 건수를 예측하는 머신러닝 모델
---

-----

#### 프로젝트 주제 및 목적
---
![Image Alt 텍스트](/assets/images/project01_01.png){: width="60%" height="60%"}    
교통사고 발생 예방을 위한 제도적, 교육적 장치가 다수 존재하며 교통사고 잠재 변인 파악을 위한 빅데이터 분석 관련 선행 연구도 수차례 진행되었다.
그러나 근시일의 교통사고 발생을 예측하고 실질적으로 예방하기 위한 노력은 부족한 실정이다.   

따라서, **교통사고 발생에 관여하는 주요 변수를 파악해 교통사고 건수를 예측하는 머신러닝 모델**을 만들고자 했다. 이를 위해 메인 모델을 서울시 데이터로 훈련시킨 후 지역별 데이터로 일반화 가능성을 검증했다.

#### 데이터 시각화
***

- **시간대별 교통사고 건수 시각화**     
![Image Alt 텍스트](/assets/images/pro01_02.png){: width="60%" height="60%"}    
    순서대로 지역구별, 시간대별 교통사고 건수를 시각화한 결과 다음과 같은 인사이트를 도출할 수 있다.
    1. 월과 교통사고 건수에 연관성이 존재한다.
    2. 요일과 교통사고 건수에 연광성이 존재한다. 상대적으로 일요일에 제일 적게, 금요일에 가장 많이 교통사고가 발생한다.
    3. 발생시간과 교통사고 건수에 연관성이 존재한다. 출퇴근 시간인 오전 8시와 오후 6시에 교통사고 건수가 증가하고 있다.
<br>

- **지역별 교통사고 건수 시각화**     
![Image Alt 텍스트](/assets/images/pro01_03.png){: width="60%" height="60%"}  
    순서대로 지역구별 교통사고와 그 지역의 시간대별 교통사고 건수를 시각화한 결과 다음과 같은 인사이트를 도출할 수 있다.
    1. 강남구의 교통사고 건수가 압도적으로 많다.
    2. 사고자로 인한 부상자는 대부분 경상자이다.

![Image Alt 텍스트](/assets/images/pro01_04.png){: width="70%" height="70%"}    
지역별 교통사고 건수를 지도에 시각화한 결과 다음과 같은 인사이트를 도출할 수 있다.      
1. 강남구, 송파구, 영등포구, 서초구가 상대적으로 높은 교통사고가 발생한다.

#### 모델링
---
##### 사용 데이터
- 서울시 개별사고 정보(2010-2018) 
    + 노면, 도로, 기상, 사고 유형 정보를 제공하고 있다.
    + 교통사고와 밀접한 관련이 있는 특성을 알아보기 위해 사용했다.

##### 데이터 전처리
![Image Alt 텍스트](/assets/images/pro01_08.png){: width="70%" height="70%"}        
- 시간대 변수 추가: 발생일 변수의 자료형을 datetime을 변환 후 여러 시간대 변수 생성
- 라벨 인코딩: 특성 변수가 많아 원핫인코딩 배제, 사고건수에 비례하게 범주형 특성 라벨링

##### 초기 모델 구현
시간대별/지역별 교통사고 건수를 예측하는 초기 모델을 구현했다. 
![Image Alt 텍스트](/assets/images/pro01_05.png){: width="70%" height="70%"}    
위처럼 시간대별/지역별로 데이터를 그룹핑해 학습했고  
2010-2017년도 데이터를 훈련 데이터로, 2018년도 데이터를 테스트 데이터로 설정하여 성능을 확인했다.
- 타깃 변수와의 연관성 높은 발생월과 부상자수로 모델을 학습했다.
- 랜덤 포레스트 / 선형 회귀 / 선형 로그 회귀 모델을 사용했다. 
- 모델 성능 평가 지표: MSE, R^2, K-Fold 후의 CV정확도 사용
- 첫 300개 샘플에 대해 실제 데이터와 예측 데이터 분포의 상이함을 시각화

![Image Alt 텍스트](/assets/images/pro01_06.png){: width="70%" height="70%"}

타깃 변수와의 연관성이 높은 발생월과 부상자수로 모델을 학습시킨 결과, 사고건수의 경우 이분산성이 크지 않아 로그 변환 시 모델의 성능이 급격히 감소했으며 랜덤 포레스트 모델의 성능이 가장 우수함을 확인했다. 이는 교통 사고 건수에 영향을 미치는 요인에는 연속형 변수보다는 범주형 변수가 많으며, 선형적 관계보다는 비선형적 관계를 지니는 변수가 많았기 때문으로 추측된다.
따라서 이후 단계부터는 **랜덤 포레스트 모델**을 중점적으로 훈련시키기로 결론지었다.

![Image Alt 텍스트](/assets/images/pro01_07.png){: width="70%" height="70%"}

직관적으로 중요하다고 보여지는 특성들부터 차례로 예측 모델에 추가하면서 모델 성능의 변화 과정을 추적했다. 너무 많은 특성 변수를 채택할 경우의 과대적합을 우려했으나, 실제로 학습을 진행한 결과 모든 특성을 추가하였을 때 모델 성능이 가장 뛰어났다. 또한, 원 핫 인코딩 과정을 생략했음에도 0.946이라는 상당히 높은 평균 CV 점수를 얻을 수 있었다.
그러나 **가해자 차량, 연령 등 교통 사고 사후적 요인이 특성에 포함되어 있어, 이를 제거하고도 높은 성능을 유지시킬 방법에 대한 추가 논의가 필요**하다. 

##### 랜덤 포레스트 조합 함수를 이용한 변수 선택
랜덤 포레스트 조합 함수를 정의해 주요 특성을 파악했다. 매개변수 리스트 내 원소을 이용해 가능한 모델 조합을 사용한 랜덤 포레스트 모델을 생성 후 score 순으로 비교해 상위 5개 모델을 출력했다. 모델 성능을 개선할 주요 변수 판단 그거로 사용했다.    

랜덤포레스트 조합 함수를 사용한 결과 기상상태, 도로형태, 도로형태_대분류, 노면상태를 최종 변수로 선택했다.

##### 서울시 교통사고 건수 최종 모델
![Image Alt 텍스트](/assets/images/pro01_09.png){: width="70%" height="70%"}    
지역구별 평균 데이터와 지역구별 합계 데이터를 생성해 모델을 생성했다.       
평균 데이터를 사용한 모델을 mean 모델, 합계 데이터를 사용한 모델은 sum 모델로 정의했다.

![Image Alt 텍스트](/assets/images/pro01_10.png){: width="50%" height="50%"}    
sum모델과 mean모델을 비교한 결과 sum모델의 정확도가 높았다.
따라서 sum모델을 최종 모델로 사용했다.

![Image Alt 텍스트](/assets/images/pro01_11.png){: width="70%" height="70%"}        
사고 내용, 사고 유형, 가해자/피해자 신상 등 사고 이후에 특정되는 정보를 제외하고 **시간 정보와 기상, 노면, 도로 형태를 모델 변수로 사용**했다.      
위 변수들을 사용해 sum모델을 학습시킨 결과 높은 예측률을 확인할 수 있었다.

![Image Alt 텍스트](/assets/images/pro01_12.png){: width="70%" height="70%"}        
실제 교통사고 건수와 예측 교통사고 건수를 지도에 시각화한 결과 잘 예측됐다는 것을 시각적으로 다시 한번 확인할 수 있었다.


하지만 처음 만들고자 했던 모델은 앞으로의 교통사고 발생 건수를 예측하는 모델이다.
그러나 현재의 모델은 지역별 교통사고 건수만 예측이 가능하다. 
또한 노면상태와 도로형태는 비교적 불변적이나 기상상태는 가변적 변수이다.
추후의 날씨 데이터를 예측하여 미래의 교통사고 건수를 예측하는 모델을 만들기 위해
최종 모델을 일자별, 지역별 교통사고 건수를 예측하는 모델로 수정했다. 

##### 예측 모델 적용(다른 지역)

#### sum 모델과 mean 모델 성능 비교

#### 추후 교통 사고 건수 예측 모델
##### 기상상태 예측 시도
##### 일자별 교통사고 건수 예측 모델
sum 모델의 단점을 보완할 수 있는 mean 모델
: sum 모델은 예측율이 높지만, 사고건수를 예측함에
있어 사고건수가 사전 정보로 요구되는 등 모델 활용이
실용적이지 않으며, 선형성의 원인 또한 정상적이지 않다.
따라서 사고건수를 실질적으로 예측하는 mean 모델을
만들고자 했으며, 이번에는 연도가 아닌 일자를, 법정동이
아닌 도로형태별로 특성 값을 그룹화하여 평균을 구했다. 
(교통사고 발생 건수는 변수 특성상 예외적으로 sum 적용)
해당 mean 모델로 학습을 진행한 결과, CV 정확도가
0.933으로 이전 mean 모델보다 훨씬 높은 성능을 보였다

#### 결론
<a href = "#데이터-시각화"> 1. 데이터 시각화 </a>       
+ 교통사고 건수와 연관성이 있는 변수들을 파악할 수 있었다.

<a href="#랜덤-포레스트-조합-함수를-이용한-변수-선택">2. 랜덤포레스트 조합 함수를 이용한 변수 선택</a>
+ **기상상태, 도로형태, 노면상태**가 교통사고에 가장 큰 영향을 미친다.

<a href="#서울시-교통사고-건수-최종-모델"> 3. 지역구별 교통사고 건수 예측  </a>
+ 2018년도의 지역별 교통사고 건수를 안정적으로 예측할 수 있었다.
+ 예측 결과 관악구, 강서구, 강동구에서 교통사고가 비교적 많이 발생한다.

<a href="#예측-모델-적용다른-지역">4. 예측 모델 적용(다른 지역)</a>
+ 다른 지역 교통사고 데이터로 모델을 일반화한 결과, 다른 지역 교통사고 건수 또한 안정적으로 예측할 수 있었다.
+ 경기도 교통사고 발생 건수의 분포가 서울시와 유사하다.
    
<a href="#추후-교통-사고-건수-예측-모델">5. 최종 모델 </a>
+ **cv 점수가 0.933으로 높은 예측율**을 보인다.
+ 그러나 이는 법정동명 등 구체적인 위치가 정보가 누락된 데이터로 적합된 모델이다.
+ 해당 위치에 대한 미시적 예측이 어렵다는 한계가 있다.

[후속 프로젝트를 위한 제언]
- **지역별 차이를 나타내는 유동인구, 가로등, 신호등, 지역별 특징 등의 변수**를 반영한다면 더 범용성 높은 예측 모델이 될 것이다.
- 일부 가변적 변수 예측을 통해 실제 교통사고 발생 건수를 예측할 수 있다.
- 서울, 경기 교통사고 발생 건수가 유사하므로 두 지역의 데이터를 함께 사용해 학습시킨다면 모델이 개선될 가능성이 있다.