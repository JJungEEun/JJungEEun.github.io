---
layout: post
title: "Model Evaluation"
date: 2019-11-05 08:44:38 -0400
category: machine-learning
author: eun
short-description: 머신 러닝 모델 성능 평가하는 방법
toc: true
---

### 모델 평가(Model Evaluation)

![Image Alt 텍스트](/assets/images/ml02_01.png){: width="500" height="300"}

우리가 만든 모델이 어떤 성능을 가지고 있는지, 어느 정도의 예측 정확도를 가지고 있는 지 등을 쉽게 파악할 수 없다. 
이때 여러 가지 방법으로 머신러닝 모델을 평가할 수 있다. 
일반적으로 <mark>성능 평가 지표</mark> (Evalution Metrics)와 <mark>예측값의 오차 평균값</mark>에 기반하여 평가한다. 평가 지표는 일반적으로 모델이 회귀인지 분류인지에 따라서 나뉜다.

+ 회귀(Regression): MSE, RMSE, R Square ...
+ 분류(classification): Precision-Recall, Accuracy, ROC-AUC ... 

<mark>회귀의 경우 대부분 실제값과 예측값의 오차 평균</mark>에 기반한다. 예를 들어 오차의 절댓값을 이용해 평균 오차를 구하거나, 오차의 제곱 값에 루트를 씌운 뒤 평균 오차를 구하는 방법과 같다. 즉, 기본적으로 예측 오차를 가지고 정규화 수준을 재가공하는 방법이 회귀의 성능 평가 지표이다.

분류의 평가 방법 또한 실제 결과 데이터와 예측 결과 데이터의 정확도를 기반으로 한다. 하지만 단순한 예측 정확도만 가지고 판단한다면 잘못된 평가 결과가 될 수 있다. <mark>정확도 외에도 오차행렬, 정밀도, 재현율, F1 Score, ROC AUC 등</mark> 다른 성능 평가 지표가 더 중요시 되는 경우가 많다.

***
### 회귀 모델의 평가 지표

#### MSE, RMSE, R Sqaure

<!-- ##### RMSE -->

<!-- ##### R Sqaure -->

***

### 분류 모델의 평가 지표

#### Confusion Matrix(오차 행렬)
<mark>오차 행렬</mark>은 주로 이진 분류의 성능 지표로 사용된다. 이진 분류의 예측 오류가 얼마인지, 어떠한 유형의 예측 오류가 발생하는지를 보여준다.

![Image Alt 텍스트](/assets/images/ml02_02.png){: width="500" height="300"} Link: [image source](https://manisha-sirsat.blogspot.com/2019/04/confusion-matrix.html)

오차 행렬은 4분면 행렬에서 실제 레이블 클래스 값과 예측 레이블 클래스 값이 어떠한 유형을 가지고 매핑되는 지 보여준다. 예측 클래스와 실제 클래스 값의 유형에 따라 <mark>TN, TP, FN, FP</mark>로 결정된다.

- True Negative(TN): 실제 False인 정답은 False라고 예측(정답)
- True Positive(TP): 실제 True인 정답을 True라고 예측(정답)
- False Negative(FN): 실제 False인 정답을 True라고 예측(오답)
- False Positive(FP): 실제 False인 정답을 True라고 예측(오답)
<br>
    ```
    from sklearn.metrics import confusion_matrix
    ```

Ex)스팸 메일 분류를 예로 들어보자. 정상적인 메일은 Negative 클래스, 스팸 메일을 Positive 클래스라고 한다.
+ TN: 정상적인 메일을 정상 메일로 분류
+ FP: 정상적인 메일을 스팸 메일로 분류
+ FN: 스팸 메일을 정상 메일로 분류
+ TP: 스팸 메일을 스팸 메일로 분류
위 4가지 성분을 활용하여 정확도, 정밀도, 재현율에 대해 알아보자.


#### Accuracy(정확도), Precision(정밀도), Recall(재현율)
<mark>정확도</mark>는 실제 데이터에서 예측 데이터가 얼마나 같은지를 판단하는 지표이다. 즉, True/False 상관 없이 정답을 맞춘 데이터의 건수 비율을 의미한다.

![Image Alt 텍스트](/assets/images/ml02_03.png)

    from sklearn.metrics import accuracy_score
    
데이터셋에서 클래스의 비율이 한 쪽으로 치우친 경우 정확도가 모델의 성능을 제대로 표현하지 못하는 경우도 있다. 이를 <mark>정확도의 역설</mark>(Accuracy Paradox)라고 한다.

[스팸 메일 분류 예]

![Image Alt 텍스트](/assets/images/ml02_04.png)

위 그림을 보면 1000통의 메일 중 정상 메일을 정상으로, 스팸 메일을 스팸으로 판별한 건수는 각각 930통, 5통이다. 1000통의 메일 중 935통을 정확하게 분류했으므로 정확도는 0.935이다. 하지만 총 50통의 스팸 메일 중 45통의 메일을 분류하지 못했다. 이걸 정확한 모델이라고 말할 수 있을까? 이것을 정확도의 역설이라 부른다. 이런 한계를 해결하기 위해 <u>정밀도와 재현율이라는 새로운 평가 지표가 필요하다.</u> 



<!-- #### Precision(정밀도)와 Recall(재현율) -->
정확도의 역설같이 정확도가 모델의 성능을 잘 표현하지 못하는 경우에 정밀도와 재현율을 사용한다. 

![Image Alt 텍스트](/assets/images/ml02_05.png)
![Image Alt 텍스트](/assets/images/ml02_07.png)

<mark>정밀도</mark>는 모델이 Positive라고 분류한 것 중에 실제 Positive인 비율을 나타낸다. <mark>재현율</mark>은 실제 Positive인 것 중에 모델이 Positive로 예측한 비율을 나타낸다.

![Image Alt 텍스트](/assets/images/ml02_06.png)

위 스팸 메일 분류 예를 다시보자. 정확도 0.935라는 높은 수치가 나왔지만 정밀도와 재현율은 0.2, 0.1로 매우 낮다. 이 두가지 지표를 사용하면 스팸 분류기의 성능이 안좋다는 것을 잘 보여준다.

정밀도는 실제 Negative 데이터를 Positive로 잘못 판단하면 업무 상 큰 영향을 입는 경우, 재현율은 실제 Positive 데이터를 Negative로 잘못 판단하면 업무상 큰 영향을 입는 경우 사용하면 좋다.



#### 정밀도와 재현율의 Trade-off
어떤 것을 분류하느냐에 따라서 정밀도가 더 중요할 수도 있고, 재현율이 더 중요할 수도 있다. 위 스팸 메일 분류 예시를 살펴보면, 45개의 스팸 메일을 받은 편지함에 두었지만 그냥 손으로 삭제하면 된다. 단지 귀찮을 뿐이다. 하지만 스팸 메일함에 들어간 경우 20통의 메일 중 면접 날짜나 비즈니스 미팅 날짜와 같은 중요한 메일이 있다면 이용자는 큰 낭패를 가지고 올 것 이다. 그렇기 때문에 스팸 메일 분류기에서는 후자인 FP를 줄이는 것, 즉 정밀도를 더 중요하게 생각해야한다.

이번엔 다른 예를 생각해보자. 암 환자의 X-ray 사진을 보고 분류하여 Positive면 정밀 진단을 하고 Negative면 무증상으로 분류하는 분류기를 만들었다. 이런 경우 FP는 암 환자가 아니지만 환자로 분류되어 정밀 검사를 통해 다시 검사하면 된다. 하지만 FN은 암 환자이지만 무증상으로 분류되는 것이다. 그렇기 때문에 이런 분류기에서는 FN을 줄이는 것, 즉 재현율을 더 중요하게 생각해야한다.

하지만 <u>정밀도와 재현율, 둘 중 하나의 수치를 더 중요하게 생각하면 다른 하나의 수치는 떨어진다.</u> 쉽게 말해 Positive로 판별하는 기준을 엄격하게 설정하면 정밀도가 높아지고 반대로 이 기준으로 널널하게 설정하면 재현율이 높아지는 것이다. 이런 현상을 <mark>정밀도와 재현율의 트레이드 오프</mark>(Precision-Recall Trade-off)라고 한다.

이 기준을 설정하는 것이 <mark>임계값</mark>이다. 분류기는 입력된 값을 기준으로 계산하고 일종의 결정 함수(Decision Function)를 사용하여 T/F 값을 출력한다. 즉 임계값에 만족하면 Positive를, 아닌 경우에는 False를 반환하는 것이다. 임계값(Threshold)을 다시 말하면 결정함수에서 사용하는 기준이다. 사용자는 분류기의 임계값을 조절하여 분류기의 출력을 조절할 수 있다. 

[추가 예시]<br>
ex) 방법 시스템-낮은 임계값: 시스템이 자주 작동하더라도, 도둑을 잡는 것이 더 중요 (높은 재현율, 낮은 정밀도) <br>
ex) 인터넷 광고 차단 시스템 - 높은 임계값: 사용자가 유용한 광고를 몇 개 못 보더라도, 불쾌한 불법 광고를 확실히 차단하는 것이 더 중요 (낮은 재현율, 높은 정밀도)

#### F1 Score
#### ROC, AUC
